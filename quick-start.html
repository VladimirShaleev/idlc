<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="Interface Definition Language Compiler">
<meta name="apple-mobile-web-app-title" content="IDLC" />
<meta name="theme-color" content="#a74646">
<meta name="msapplication-TileColor" content="#a74646">
<meta name="msapplication-TileImage" content="mstile-144x144.png">
<meta name="msapplication-square70x70logo" content="mstile-70x70.png">
<meta name="msapplication-square150x150logo" content="mstile-150x150.png">
<meta name="msapplication-wide310x150logo" content="mstile-310x310.png">
<meta name="msapplication-square310x310logo" content="mstile-310x150.png">
<meta name="msapplication-config" content="browserconfig.xml">
<meta name="application-name" content="IDLC">
<meta name="google-site-verification" content="uQYFmsuPjcXUmeBoLNMqxmIJ4S__SUukKLX_xzT9sH4" />
<meta name="msvalidate.01" content="E78F7336FAA956728F9E29CB3CFC7741" />
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="IDLC" />
<meta property="og:image" content="https://vladimirshaleev.github.io/idlc/preview.png" />
<meta property="og:description" content="Interface Definition Language Compiler" />
<meta property="og:url" content="https://github.com/VladimirShaleev/idlc/" />
<!-- END opengraph metadata -->
<title>idlc: Quick Start</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="icon" href="favicon-16x16.png" sizes="16x16" type="image/png" />
<link rel="icon" href="favicon-32x32.png" sizes="32x32" type="image/png" />
<link rel="icon" href="favicon-96x96.png" sizes="96x96" type="image/png" />
<link rel="icon" href="favicon-120x120.png" sizes="120x120" type="image/png" />
<link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png" />
<link rel="mask-icon" color="#333333" href="safari-pinned-tab.svg" />
<link rel="manifest" href="site.webmanifest" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript" src="idlc-doc.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/json.min.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
    DoxygenHighlight.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
<link href="idlc-doc.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">idlc<span id="projectnumber">&#160;1.5.15</span>
   </div>
   <div id="projectbrief">Interface Definition Language Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('quick-start.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Quick Start</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#create-lib">Creating a Simple Library</a>
    <ul>
      <li class="level2">
        <a href="#add-c-lib">Adding Specifications for a C Library</a>
        <ul>
          <li class="level3">
            <a href="#idl-spec">IDL Specifications</a>
          </li>
          <li class="level3">
            <a href="#add-idlc-dep">Adding IDLC Dependency</a>
          </li>
          <li class="level3">
            <a href="#add-cmake-config">Adding CMake Configuration</a>
          </li>
          <li class="level3">
            <a href="#impl-c-decls">Implementing C Declarations</a>
          </li>
          <li class="level3">
            <a href="#doctest-lib">Testing the Library</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#js-lib">Building a Native JavaScript Library</a>
        <ul>
          <li class="level3">
            <a href="#add-wasm">Adding WASM Support</a>
          </li>
          <li class="level3">
            <a href="#npm-package">Creating an NPM Package</a>
          </li>
          <li class="level3">
            <a href="#npm-tests">Adding Tests to the NPM Package</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#conclusion">Conclusion</a>
      </li>
      <li class="level2">
        <a href="#next-steps">Next Steps</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="create-lib"></a>
Creating a Simple Library</h1>
<p>Here we'll create a simple C library using <b>IDLC</b>:</p><ul>
<li>ready for distribution via packages like <b>.deb</b> or package managers like <b>vcpkg</b> or <b>Conan</b>;</li>
<li>then we'll package this library as an <b>npm</b> package for native use in JavaScript applications.</li>
</ul>
<p>You can clone and build the ready-made example from <a href="https://github.com/VladimirShaleev/idlc/tree/sample">this branch</a>.</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line">git clone -b sample https://github.com/VladimirShaleev/idlc.git idlc-sample</div>
</div><!-- fragment --><p>and also follow its <code>README</code> on building and testing the library. Here we will also take a detailed step-by-step look at how to create this library.</p>
<h2><a class="anchor" id="add-c-lib"></a>
Adding Specifications for a C Library</h2>
<h3><a class="anchor" id="idl-spec"></a>
IDL Specifications</h3>
<p>Add <b>IDL</b> specifications anywhere in your library. For example, create a <code>specs</code> folder in your project's root directory and add an <code>api.idl</code> file (or use any other filename).</p>
<p>A typical project structure might look like this:</p>
<div class="fragment"><div class="line">sample/</div>
<div class="line">|-- include/</div>
<div class="line">|   `-- sample/</div>
<div class="line">|-- src/</div>
<div class="line">|   `-- sample.c</div>
<div class="line">|-- specs/</div>
<div class="line">|   `-- api.idl</div>
<div class="line">`-- CMakeLists.txt</div>
</div><!-- fragment --><p>Add the following content to your <code>api.idl</code> file:</p>
<div class="fragment"><div class="line">@idl</div>
<div class="line">@ API Sample</div>
<div class="line">@ Author &lt;author@email.org&gt; [author]</div>
<div class="line">@ MIT License [copyright]</div>
<div class="line">api Sample</div>
<div class="line"> </div>
<div class="line">@ Function sample.</div>
<div class="line">@ The result of multiplying {First} by {Second}. [return]</div>
<div class="line">func Mul {Float32}</div>
<div class="line">    arg First {Float32} @ First value</div>
<div class="line">    arg Second {Float32} @ Second value</div>
<div class="line"> </div>
<div class="line">@ Vector 3.</div>
<div class="line">struct Vector</div>
<div class="line">    field X {Float32} @ X component</div>
<div class="line">    field Y {Float32} @ Y component</div>
<div class="line">    field Z {Float32} @ Z component</div>
<div class="line"> </div>
<div class="line">@ Sample object.</div>
<div class="line">interface Vehicle</div>
<div class="line">    prop Name [get(GetName)] @ Name of vehicle</div>
<div class="line"> </div>
<div class="line">    @ Create new vehicle instance.</div>
<div class="line">    @ Vehicle instance. [return]</div>
<div class="line">    method Create {Vehicle} [ctor]</div>
<div class="line">        arg Name {Str} @ Name of vehicle.</div>
<div class="line"> </div>
<div class="line">    @ Destroy vehicle instance.</div>
<div class="line">    method Destroy [destroy]</div>
<div class="line">        arg Vehicle {Vehicle} [this] @ The &#39;this/self&#39; object in OOP languages.</div>
<div class="line"> </div>
<div class="line">    @ Get name</div>
<div class="line">    @ Get name of vehicle [detail]</div>
<div class="line">    @ Return name of vehicle [return]</div>
<div class="line">    method GetName {Str} [const]</div>
<div class="line">        arg Vehicle {Vehicle} [this] @ The &#39;this/self&#39; object in OOP languages.</div>
<div class="line"> </div>
<div class="line">    @ Set velocity of vehicle.</div>
<div class="line">    method SetVelocity</div>
<div class="line">        arg Vehicle {Vehicle} [this] @ The &#39;this/self&#39; object in OOP languages.</div>
<div class="line">        arg Value {Vector} [const,ref] @ Value of velocity.</div>
<div class="line"> </div>
<div class="line">    @ Example calculation</div>
<div class="line">    @ Dot product. [return]</div>
<div class="line">    method DotVelocity {Float32} [const]</div>
<div class="line">        arg Vehicle {Vehicle} [this] @ The &#39;this/self&#39; object in OOP languages.</div>
<div class="line">        arg Value {Vector} [const,ref] @ Value of velocity.</div>
</div><!-- fragment --><p>While the complete IDL syntax isn't crucial at this stage, here are the key points to understand:</p><ul>
<li><b>Declarations</b> always begin with keywords like: <code>api</code>, <code>struct</code>, <code>interface</code>, etc.</li>
<li><b>Naming conventions</b>:<ul>
<li>Names must start with a capital letter.</li>
<li>Automatic tokenization occurs at capital letters.</li>
<li>See the <a href="language-guide.html#attr-tokenizer">[tokenizer]</a> for customizing tokenization rules.</li>
</ul>
</li>
<li><b>Documentation requirements</b>:<ul>
<li>Every declaration must include at least <code>[brief]</code> or <code>[detail]</code> documentation.</li>
<li>Documentation starts with the <code>@</code> symbol - everything until the newline counts as documentation.</li>
</ul>
</li>
<li><b>Attributes</b>:<ul>
<li>Optional attributes may follow declarations or documentation, enclosed in square brackets <code>[]</code> and comma-separated (e.g., <code>[author]</code> or <code>[const,ref]</code>).</li>
<li>Note: <code>arg Value {Vector} [const,ref]</code> is syntactic sugar for <code>arg Value [type(Vector),const,ref]</code> (here <code>type</code> explicitly specifies the argument type).</li>
</ul>
</li>
<li><b>Documentation placement</b>: documentation on the same line after a declaration defaults to <code>[detail]</code> documentation for that declaration.</li>
<li><b>Formatting rules</b>: indentation and line breaks are insignificant in <b>IDL</b>, except within documentation contexts.</li>
</ul>
<h3><a class="anchor" id="add-idlc-dep"></a>
Adding IDLC Dependency</h3>
<dl class="section note"><dt>Note</dt><dd>This example will use <b>vcpkg</b> for dependency management. Install <b>vcpkg</b> by following the <a href="https://learn.microsoft.com/vcpkg/get_started/get-started">official installation guide</a>.</dd></dl>
<p><b>IDLC</b> is registered in the <b>vcpkg</b> user registry. You need to add this registry to your <code>vcpkg-configuration.json</code> file:</p>
<div class="fragment"><div class="line">@json</div>
<div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/microsoft/vcpkg-tool/main/docs/vcpkg-configuration.schema.json&quot;,</div>
<div class="line">  &quot;default-registry&quot;: {</div>
<div class="line">    &quot;kind&quot;: &quot;git&quot;,</div>
<div class="line">    &quot;baseline&quot;: &quot;0cf34c184ce990471435b5b9c92edcf7424930b1&quot;,</div>
<div class="line">    &quot;repository&quot;: &quot;https://github.com/microsoft/vcpkg&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;registries&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;kind&quot;: &quot;git&quot;,</div>
<div class="line">      &quot;baseline&quot;: &quot;88b3d5b8d6466493c2215f10d5fc8618b578fe13&quot;,</div>
<div class="line">      &quot;reference&quot;: &quot;vcpkg-registry&quot;,</div>
<div class="line">      &quot;repository&quot;: &quot;https://github.com/VladimirShaleev/idlc&quot;,</div>
<div class="line">      &quot;packages&quot;: [</div>
<div class="line">        &quot;idlc&quot;</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Then add the dependency in your <code>vcpkg.json</code> file:</p>
<div class="fragment"><div class="line">@json</div>
<div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/microsoft/vcpkg-tool/main/docs/vcpkg.schema.json&quot;,</div>
<div class="line">  &quot;name&quot;: &quot;sample&quot;,</div>
<div class="line">  &quot;dependencies&quot;: [</div>
<div class="line">    &quot;idlc&quot;</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <b>idlc</b> dependency will add the <b>idlc</b> build host tool. This means that when building for a different target platform, such as Android NDK (arm64-android, arm-neon-android, etc.), this dependency will use the host tool for the build platform, which could be x64-windows or x64-linux, etc. This dependency also adds CMake configuration with the <code>idlc_compile</code> function.</p>
<p>The project structure now looks like this:</p>
<div class="fragment"><div class="line">sample/</div>
<div class="line">|-- include/</div>
<div class="line">|   `-- sample/</div>
<div class="line">|-- src/</div>
<div class="line">|   `-- sample.c</div>
<div class="line">|-- specs/</div>
<div class="line">|   `-- api.idl</div>
<div class="line">`-- CMakeLists.txt</div>
<div class="line">|-- vcpkg-configuration.json</div>
<div class="line">`-- vcpkg.json</div>
</div><!-- fragment --><h3><a class="anchor" id="add-cmake-config"></a>
Adding CMake Configuration</h3>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">find_package(idlc CONFIG REQUIRED)</div>
<div class="line">idlc_compile(NAME api WARN_AS_ERRORS</div>
<div class="line">    SOURCE &quot;${PROJECT_SOURCE_DIR}/specs/api.idl&quot;</div>
<div class="line">    OUTPUT &quot;${PROJECT_SOURCE_DIR}/include/sample/sample.h&quot;</div>
<div class="line">    VERSION ${PROJECT_VERSION}</div>
<div class="line">    GENERATOR C)</div>
<div class="line"> </div>
<div class="line">add_library(sample src/sample.c ${IDLC_api_OUTPUTS})</div>
</div><!-- fragment --><details >
<summary >
A complete <code>CMakeLists.txt</code> file might look like this</summary>
<p></p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line"> </div>
<div class="line">option(SAMPLE_BUILD_TESTS &quot;Build tests&quot; ON)</div>
<div class="line">if(SAMPLE_BUILD_TESTS)</div>
<div class="line">    list(APPEND VCPKG_MANIFEST_FEATURES &quot;tests&quot;)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">project(sample</div>
<div class="line">    DESCRIPTION &quot;Example of creating a library&quot;</div>
<div class="line">    VERSION 1.0.0</div>
<div class="line">    LANGUAGES C CXX)</div>
<div class="line"> </div>
<div class="line">option(SAMPLE_MSVC_DYNAMIC_RUNTIME &quot;Link dynamic runtime library instead of static&quot; OFF)</div>
<div class="line"> </div>
<div class="line">find_package(idlc CONFIG REQUIRED)</div>
<div class="line">idlc_compile(NAME api WARN_AS_ERRORS</div>
<div class="line">    SOURCE &quot;${PROJECT_SOURCE_DIR}/specs/api.idl&quot;</div>
<div class="line">    OUTPUT &quot;${PROJECT_SOURCE_DIR}/include/sample/sample.h&quot;</div>
<div class="line">    VERSION ${PROJECT_VERSION}</div>
<div class="line">    GENERATOR C)</div>
<div class="line"> </div>
<div class="line">add_library(sample src/sample.c ${IDLC_api_OUTPUTS})</div>
<div class="line">add_library(sample::sample ALIAS sample)</div>
<div class="line">target_include_directories(sample PUBLIC</div>
<div class="line">    $&lt;BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include&gt;</div>
<div class="line">    $&lt;INSTALL_INTERFACE:include&gt;)</div>
<div class="line">set_target_properties(sample PROPERTIES</div>
<div class="line">    CXX_STANDARD_REQUIRED ON</div>
<div class="line">    CXX_EXTENSIONS OFF</div>
<div class="line">    POSITION_INDEPENDENT_CODE ON</div>
<div class="line">    WINDOWS_EXPORT_ALL_SYMBOLS OFF)</div>
<div class="line">target_compile_definitions(sample PRIVATE _CRT_SECURE_NO_WARNINGS)</div>
<div class="line">if(BUILD_SHARED_LIBS)</div>
<div class="line">    set_target_properties(sample PROPERTIES VERSION ${PROJECT_VERSION} SOVERSION ${PROJECT_VERSION_MAJOR})</div>
<div class="line">    set_target_properties(sample PROPERTIES CXX_VISIBILITY_PRESET hidden VISIBILITY_INLINES_HIDDEN ON)</div>
<div class="line">else()</div>
<div class="line">    target_compile_definitions(sample PUBLIC SAMPLE_STATIC_BUILD)</div>
<div class="line">endif()</div>
<div class="line">if(MSVC)</div>
<div class="line">    if(SAMPLE_MSVC_DYNAMIC_RUNTIME)</div>
<div class="line">        set_target_properties(sample PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;DLL&quot;)</div>
<div class="line">    else()</div>
<div class="line">        set_target_properties(sample PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&quot;)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
</div><!-- fragment --> </details>
<p>The <code>api</code> <code>NAME</code> specified in <code>idlc_compile</code> will be used to form the <code>IDLC_&lt;NAME&gt;_OUTPUTS</code> variable containing the generated output files.</p>
<h3><a class="anchor" id="impl-c-decls"></a>
Implementing C Declarations</h3>
<p>The public headers are now automatically updated when <code>.idl</code> specifications change. You can now implement the generated function definitions.</p>
<details >
<summary >
Here's an example implementation (<code>sample.c</code>)</summary>
<p></p>
<div class="fragment"><div class="line">@c</div>
<div class="line"><span class="preprocessor">#include &quot;sample/sample.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NAME_LENGTH 256</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>_sample_vehicle</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> name[NAME_LENGTH];</div>
<div class="line">    sample_vector_t velocity;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">sample_float32_t sample_mul(sample_float32_t first, sample_float32_t second)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> first * second;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">sample_vehicle_t sample_vehicle_create(sample_utf8_t name)</div>
<div class="line">{</div>
<div class="line">    sample_vehicle_t instance = (sample_vehicle_t)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> _sample_vehicle));</div>
<div class="line">    memset(instance, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> _sample_vehicle));</div>
<div class="line">    strncpy(instance-&gt;name, name, NAME_LENGTH);</div>
<div class="line">    <span class="keywordflow">return</span> instance;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sample_vehicle_destroy(sample_vehicle_t vehicle)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (vehicle)</div>
<div class="line">    {</div>
<div class="line">        free(vehicle);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">sample_utf8_t sample_vehicle_get_name(sample_vehicle_t vehicle)</div>
<div class="line">{</div>
<div class="line">    assert(vehicle);</div>
<div class="line">    <span class="keywordflow">return</span> vehicle-&gt;name;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> sample_vehicle_set_velocity(sample_vehicle_t vehicle, <span class="keyword">const</span> sample_vector_t *value)</div>
<div class="line">{</div>
<div class="line">    assert(vehicle);</div>
<div class="line">    assert(value);</div>
<div class="line">    vehicle-&gt;velocity = *value;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">sample_float32_t sample_vehicle_dot_velocity(sample_vehicle_t vehicle, <span class="keyword">const</span> sample_vector_t *value)</div>
<div class="line">{</div>
<div class="line">    assert(vehicle);</div>
<div class="line">    <span class="keyword">const</span> sample_vector_t *vec = &amp;vehicle-&gt;velocity;</div>
<div class="line">    <span class="keywordflow">return</span> vec-&gt;x * value-&gt;x + vec-&gt;y * value-&gt;y + vec-&gt;z * value-&gt;z;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<h3><a class="anchor" id="doctest-lib"></a>
Testing the Library</h3>
<p>We'll add <b>doctest</b> to test the library:</p>
<div class="fragment"><div class="line">@cpp</div>
<div class="line"><span class="preprocessor">#include &lt;sample/sample.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN</span></div>
<div class="line"><span class="preprocessor">#include &lt;doctest/doctest.h&gt;</span></div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;mul test&quot;</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> expected = doctest::Approx(7.68f).epsilon(0.01f);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> actual = sample_mul(3.2f, 2.4f);</div>
<div class="line"> </div>
<div class="line">    CHECK(expected == actual);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;object test&quot;</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> expected = doctest::Approx(10.0f).epsilon(0.01f);</div>
<div class="line"> </div>
<div class="line">    sample_vehicle_t vehicle = sample_vehicle_create(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line">    CHECK(vehicle != <span class="keyword">nullptr</span>);</div>
<div class="line"> </div>
<div class="line">    sample_vector_t first{1.0f, 2.0f, 3.0f};</div>
<div class="line">    sample_vehicle_set_velocity(vehicle, &amp;first);</div>
<div class="line"> </div>
<div class="line">    sample_vector_t second{3.0f, 2.0f, 1.0f};</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> actual = sample_vehicle_dot_velocity(vehicle, &amp;second);</div>
<div class="line"> </div>
<div class="line">    sample_vehicle_destroy(vehicle);</div>
<div class="line"> </div>
<div class="line">    CHECK(expected == actual);</div>
<div class="line">}</div>
</div><!-- fragment --><details >
<summary >
View all changes</summary>
<p></p>
<p>Current project structure:</p>
<div class="fragment"><div class="line">sample/</div>
<div class="line">|-- cmake/</div>
<div class="line">|   |-- vcpkg.cmake</div>
<div class="line">|   `-- sample-config.cmake.in</div>
<div class="line">|-- include/</div>
<div class="line">|   `-- sample/</div>
<div class="line">|       |-- sample-version.h</div>
<div class="line">|       |-- sample-platform.h</div>
<div class="line">|       |-- sample-types.h</div>
<div class="line">|       `-- sample.h</div>
<div class="line">|-- src/</div>
<div class="line">|   `-- sample.c</div>
<div class="line">|-- tests/</div>
<div class="line">|   |-- CMakeLists.txt</div>
<div class="line">|   `-- tests.cpp</div>
<div class="line">|-- specs/</div>
<div class="line">|   `-- api.idl</div>
<div class="line">|-- CMakeLists.txt</div>
<div class="line">|-- vcpkg-configuration.json</div>
<div class="line">`-- vcpkg.json</div>
</div><!-- fragment --><p>Contents of <code>./CMakeLists.txt</code> (including <b>install</b> target):</p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line"> </div>
<div class="line">include(cmake/vcpkg.cmake)</div>
<div class="line"> </div>
<div class="line">option(SAMPLE_BUILD_TESTS &quot;Build tests&quot; ON)</div>
<div class="line">if(SAMPLE_BUILD_TESTS)</div>
<div class="line">    list(APPEND VCPKG_MANIFEST_FEATURES &quot;tests&quot;)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">project(sample</div>
<div class="line">    DESCRIPTION &quot;Example of creating a library&quot;</div>
<div class="line">    VERSION 1.0.0</div>
<div class="line">    LANGUAGES C CXX)</div>
<div class="line"> </div>
<div class="line">option(SAMPLE_MSVC_DYNAMIC_RUNTIME &quot;Link dynamic runtime library instead of static&quot; OFF)</div>
<div class="line">option(SAMPLE_ENABLE_INSTALL &quot;Enable installation&quot; ON)</div>
<div class="line"> </div>
<div class="line">find_package(idlc CONFIG REQUIRED)</div>
<div class="line">idlc_compile(NAME api WARN_AS_ERRORS</div>
<div class="line">    SOURCE &quot;${PROJECT_SOURCE_DIR}/specs/api.idl&quot;</div>
<div class="line">    OUTPUT &quot;${PROJECT_SOURCE_DIR}/include/sample/sample.h&quot;</div>
<div class="line">    VERSION ${PROJECT_VERSION}</div>
<div class="line">    GENERATOR C)</div>
<div class="line"> </div>
<div class="line">add_library(sample src/sample.c ${IDLC_api_OUTPUTS})</div>
<div class="line">add_library(sample::sample ALIAS sample)</div>
<div class="line">target_include_directories(sample PUBLIC</div>
<div class="line">    $&lt;BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include&gt;</div>
<div class="line">    $&lt;INSTALL_INTERFACE:include&gt;)</div>
<div class="line">set_target_properties(sample PROPERTIES</div>
<div class="line">    CXX_STANDARD_REQUIRED ON</div>
<div class="line">    CXX_EXTENSIONS OFF</div>
<div class="line">    POSITION_INDEPENDENT_CODE ON</div>
<div class="line">    WINDOWS_EXPORT_ALL_SYMBOLS OFF)</div>
<div class="line">target_compile_definitions(sample PRIVATE _CRT_SECURE_NO_WARNINGS)</div>
<div class="line">if(BUILD_SHARED_LIBS)</div>
<div class="line">    set_target_properties(sample PROPERTIES VERSION ${PROJECT_VERSION} SOVERSION ${PROJECT_VERSION_MAJOR})</div>
<div class="line">    set_target_properties(sample PROPERTIES CXX_VISIBILITY_PRESET hidden VISIBILITY_INLINES_HIDDEN ON)</div>
<div class="line">else()</div>
<div class="line">    target_compile_definitions(sample PUBLIC SAMPLE_STATIC_BUILD)</div>
<div class="line">endif()</div>
<div class="line">if(MSVC)</div>
<div class="line">    if(SAMPLE_MSVC_DYNAMIC_RUNTIME)</div>
<div class="line">        set_target_properties(sample PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;DLL&quot;)</div>
<div class="line">    else()</div>
<div class="line">        set_target_properties(sample PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&quot;)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">if(SAMPLE_BUILD_TESTS)</div>
<div class="line">    include(CTest)</div>
<div class="line">    add_subdirectory(tests)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">if(SAMPLE_ENABLE_INSTALL)</div>
<div class="line">    include(CMakePackageConfigHelpers)</div>
<div class="line">    include(GNUInstallDirs)</div>
<div class="line">    configure_package_config_file(</div>
<div class="line">        &quot;${CMAKE_CURRENT_SOURCE_DIR}/cmake/${PROJECT_NAME}-config.cmake.in&quot; </div>
<div class="line">        &quot;${PROJECT_BINARY_DIR}/${PROJECT_NAME}-config.cmake&quot;</div>
<div class="line">        INSTALL_DESTINATION &quot;${CMAKE_INSTALL_DATADIR}/cmake/${PROJECT_NAME}&quot;</div>
<div class="line">        NO_SET_AND_CHECK_MACRO</div>
<div class="line">        NO_CHECK_REQUIRED_COMPONENTS_MACRO)</div>
<div class="line"> </div>
<div class="line">    write_basic_package_version_file(${PROJECT_NAME}-config-version.cmake</div>
<div class="line">        VERSION ${PROJECT_VERSION}</div>
<div class="line">        COMPATIBILITY SameMajorVersion)</div>
<div class="line"> </div>
<div class="line">    install(TARGETS ${PROJECT_NAME} EXPORT ${PROJECT_NAME}-targets)</div>
<div class="line">    install(EXPORT ${PROJECT_NAME}-targets </div>
<div class="line">        DESTINATION &quot;${CMAKE_INSTALL_DATADIR}/cmake/${PROJECT_NAME}&quot;</div>
<div class="line">        NAMESPACE ${PROJECT_NAME}::)</div>
<div class="line">    install(</div>
<div class="line">        FILES</div>
<div class="line">            &quot;${PROJECT_BINARY_DIR}/${PROJECT_NAME}-config-version.cmake&quot;</div>
<div class="line">            &quot;${PROJECT_BINARY_DIR}/${PROJECT_NAME}-config.cmake&quot;</div>
<div class="line">        DESTINATION ${CMAKE_INSTALL_DATADIR}/cmake/${PROJECT_NAME})</div>
<div class="line">    install(DIRECTORY include/ DESTINATION include)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>Contents of <code>./cmake/vcpkg.cmake</code>:</p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">if(DEFINED Z_VCPKG_ROOT_DIR)</div>
<div class="line">    return()</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">if(DEFINED CMAKE_TOOLCHAIN_FILE)</div>
<div class="line">    return()</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">if(DEFINED ENV{VCPKG_ROOT})</div>
<div class="line">    set(CMAKE_TOOLCHAIN_FILE &quot;$ENV{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake&quot; CACHE STRING &quot;Vcpkg toolchain file&quot;)</div>
<div class="line">else()</div>
<div class="line">    message(WARNING &quot;vcpkg not found, so will be installed in the project build directory; &quot;</div>
<div class="line">        &quot;it is recommended to install vcpkg according to the instructions, which will &quot;</div>
<div class="line">        &quot;allow correct caching of build dependencies (https://learn.microsoft.com/vcpkg/get_started/get-started)&quot;)</div>
<div class="line">    include(FetchContent)</div>
<div class="line">    FetchContent_Declare(</div>
<div class="line">        vcpkg</div>
<div class="line">        GIT_REPOSITORY https://github.com/microsoft/vcpkg/</div>
<div class="line">        GIT_TAG 2025.06.13)</div>
<div class="line">    FetchContent_MakeAvailable(vcpkg)</div>
<div class="line">    set(CMAKE_TOOLCHAIN_FILE &quot;${vcpkg_SOURCE_DIR}/scripts/buildsystems/vcpkg.cmake&quot; CACHE STRING &quot;Vcpkg toolchain file&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>Contents of <code>./cmake/sample-config.cmake.in</code>:</p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">@PACKAGE_INIT@</div>
<div class="line">include(&quot;${CMAKE_CURRENT_LIST_DIR}/@PROJECT_NAME@-targets.cmake&quot;)</div>
</div><!-- fragment --><p>Contents of <code>./tests/CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">enable_testing()</div>
<div class="line"> </div>
<div class="line">find_package(doctest CONFIG REQUIRED)</div>
<div class="line"> </div>
<div class="line">add_executable(sample-tests tests.cpp)</div>
<div class="line">target_link_libraries(sample-tests PRIVATE sample::sample)</div>
<div class="line">target_link_libraries(sample-tests PRIVATE doctest::doctest)</div>
<div class="line">target_compile_features(sample-tests PRIVATE cxx_std_20)</div>
<div class="line">set_target_properties(sample-tests PROPERTIES</div>
<div class="line">    CXX_STANDARD_REQUIRED ON</div>
<div class="line">    CXX_EXTENSIONS OFF</div>
<div class="line">    POSITION_INDEPENDENT_CODE ON</div>
<div class="line">    WINDOWS_EXPORT_ALL_SYMBOLS OFF)</div>
<div class="line">if(MSVC)</div>
<div class="line">    if(SAMPLE_MSVC_DYNAMIC_RUNTIME)</div>
<div class="line">        set_target_properties(sample-tests PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;DLL&quot;)</div>
<div class="line">    else()</div>
<div class="line">        set_target_properties(sample-tests PROPERTIES MSVC_RUNTIME_LIBRARY &quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&quot;)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">include(doctest)</div>
<div class="line">doctest_discover_tests(sample-tests)</div>
</div><!-- fragment --><p>Contents of <code>./vcpkg.json</code>:</p>
<div class="fragment"><div class="line">@json</div>
<div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/microsoft/vcpkg-tool/main/docs/vcpkg.schema.json&quot;,</div>
<div class="line">  &quot;name&quot;: &quot;sample&quot;,</div>
<div class="line">  &quot;dependencies&quot;: [</div>
<div class="line">    &quot;idlc&quot;</div>
<div class="line">  ],</div>
<div class="line">  &quot;features&quot;: {</div>
<div class="line">    &quot;tests&quot;: {</div>
<div class="line">      &quot;description&quot;: &quot;Build tests&quot;,</div>
<div class="line">      &quot;dependencies&quot;: [</div>
<div class="line">        &quot;doctest&quot;</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<p>You can now build the project and run the tests:</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line"># Configure the project</div>
<div class="line">cmake -B build -S .</div>
<div class="line"> </div>
<div class="line"># Build the project</div>
<div class="line">cmake --build build</div>
<div class="line"> </div>
<div class="line"># Run tests</div>
<div class="line">cd build</div>
<div class="line">ctest --output-on-failure</div>
<div class="line"># or (if cmake &gt;= 3.20)</div>
<div class="line">ctest --test-dir build --output-on-failure</div>
</div><!-- fragment --><h2><a class="anchor" id="js-lib"></a>
Building a Native JavaScript Library</h2>
<h3><a class="anchor" id="add-wasm"></a>
Adding WASM Support</h3>
<p>If you're not working in the <b>Dev Container</b>, you'll need to:</p><ul>
<li>Install <b>Emscripten</b> following the <a href="https://emscripten.org/docs/getting_started/downloads.html">official guide</a> for JS module compilation</li>
<li>Install Node.js for <b>npm</b> package building</li>
</ul>
<p>While you could build the JS library directly using <b>emcc</b>, we'll instead add <b>Emscripten</b> configuration to <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">@cmake</div>
<div class="line">if(EMSCRIPTEN)</div>
<div class="line">    idlc_compile(NAME api_js WARN_AS_ERRORS</div>
<div class="line">        SOURCE &quot;${PROJECT_SOURCE_DIR}/specs/api.idl&quot;</div>
<div class="line">        OUTPUT &quot;${PROJECT_BINARY_DIR}/sample.js.cpp&quot;</div>
<div class="line">        VERSION ${PROJECT_VERSION}</div>
<div class="line">        GENERATOR JS)</div>
<div class="line"> </div>
<div class="line">    set(SAMPLE_JS_LINK_OPTIONS -sWASM=1 -sMODULARIZE=1 -sALLOW_MEMORY_GROWTH=1 -sEXPORT_NAME=sample)</div>
<div class="line">    if(CMAKE_BUILD_TYPE STREQUAL &quot;Debug&quot;)</div>
<div class="line">        list(APPEND SAMPLE_JS_LINK_OPTIONS &quot;-sSINGLE_FILE=0&quot;)</div>
<div class="line">    else()</div>
<div class="line">        list(APPEND SAMPLE_JS_LINK_OPTIONS &quot;-sSINGLE_FILE=1&quot;)</div>
<div class="line">    endif()</div>
<div class="line"> </div>
<div class="line">    add_executable(samplejs ${IDLC_api_js_OUTPUTS})</div>
<div class="line">    target_link_libraries(samplejs PRIVATE embind sample::sample)</div>
<div class="line">    target_include_directories(samplejs PRIVATE &quot;${PROJECT_SOURCE_DIR}/include/sample/&quot;)</div>
<div class="line">    target_compile_features(samplejs PRIVATE cxx_std_20)</div>
<div class="line">    target_link_options(samplejs PRIVATE ${SAMPLE_JS_LINK_OPTIONS} --emit-tsd sample.d.ts)</div>
<div class="line">    set_target_properties(samplejs PROPERTIES OUTPUT_NAME &quot;sample&quot; SUFFIX &quot;.js&quot; RUNTIME_OUTPUT_DIRECTORY &quot;${PROJECT_SOURCE_DIR}/dist/&quot;)</div>
<div class="line"> </div>
<div class="line">    add_executable(samplejsesm ${IDLC_api_js_OUTPUTS})</div>
<div class="line">    target_link_libraries(samplejsesm PRIVATE embind sample::sample)</div>
<div class="line">    target_include_directories(samplejsesm PRIVATE &quot;${PROJECT_SOURCE_DIR}/include/sample/&quot;)</div>
<div class="line">    target_compile_features(samplejsesm PRIVATE cxx_std_20)</div>
<div class="line">    target_link_options(samplejsesm PRIVATE ${SAMPLE_JS_LINK_OPTIONS} --emit-tsd sample.esm.d.ts -sEXPORT_ES6=1)</div>
<div class="line">    set_target_properties(samplejsesm PROPERTIES OUTPUT_NAME &quot;sample.esm&quot; SUFFIX &quot;.js&quot; RUNTIME_OUTPUT_DIRECTORY &quot;${PROJECT_SOURCE_DIR}/dist/&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>When CMake targets <b>WASM</b>, we'll generate <b>Embind</b> bindings in the build output directory. This output file will be a dependency for two targets: <code>samplejs</code> and <code>samplejsesm</code> (for UMD and ESM respectively). These two targets link our C library <code>sample::sample</code> along with <b>Embind</b>. When built, these targets create JS modules with <b>WASM</b> in the <b>npm</b> package's root <code>./dist/</code> directory.</p>
<h3><a class="anchor" id="npm-package"></a>
Creating an NPM Package</h3>
<p>If you also want to publish the resulting module as an npm package, you'll need to add a <code>package.json</code> file at the root of your library.</p>
<p>Its contents might look like this:</p>
<div class="fragment"><div class="line">@json</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;sample&quot;,</div>
<div class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Example of creating a library&quot;,</div>
<div class="line">  &quot;main&quot;: &quot;dist/sample.js&quot;,</div>
<div class="line">  &quot;module&quot;: &quot;dist/sample.esm.js&quot;,</div>
<div class="line">  &quot;browser&quot;: &quot;dist/sample.js&quot;,</div>
<div class="line">  &quot;types&quot;: &quot;dist/sample.d.ts&quot;,</div>
<div class="line">  &quot;files&quot;: [&quot;dist&quot;],</div>
<div class="line">  &quot;type&quot;: &quot;module&quot;,</div>
<div class="line">  &quot;exports&quot;: {</div>
<div class="line">    &quot;.&quot;: {</div>
<div class="line">      &quot;require&quot;: &quot;./dist/sample.js&quot;,</div>
<div class="line">      &quot;import&quot;: &quot;./dist/sample.esm.js&quot;,</div>
<div class="line">      &quot;browser&quot;: &quot;./dist/sample.js&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;./package.json&quot;: &quot;./package.json&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;scripts&quot;: {</div>
<div class="line">    &quot;build&quot;: &quot;...&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Add the following line to the build script:</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line">cmake -Bwasmbuild -S. -DVCPKG_TARGET_TRIPLET=wasm32-emscripten -DCMAKE_TOOLCHAIN_FILE=${VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake -DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=${EMSDK}/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake -DCMAKE_CROSSCOMPILING_EMULATOR=${EMSDK_NODE} -DSAMPLE_BUILD_TESTS=OFF -DSAMPLE_ENABLE_INSTALL=OFF -G Ninja -DCMAKE_BUILD_TYPE=MinSizeRel &amp;&amp; cmake --build wasmbuild</div>
</div><!-- fragment --><p>This script configures CMake for the <b>WASM</b> target platform and then builds the <code>.js</code> modules.</p>
<p>Now you can run:</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line">npm run build</div>
</div><!-- fragment --><p>That's essentially all you need to create the JS module.</p>
<h3><a class="anchor" id="npm-tests"></a>
Adding Tests to the NPM Package</h3>
<p>We won't add dependencies for unit tests, but instead will simply include a Node.js script for working with our package at <code>./tests/node-test-esm.js</code>:</p>
<div class="fragment"><div class="line">@javascript</div>
<div class="line">import sampleInit from &#39;sample&#39;;</div>
<div class="line"> </div>
<div class="line">const sample = await sampleInit();</div>
<div class="line"> </div>
<div class="line">const result = sample.mul(3.2, 2.5)</div>
<div class="line">console.log(`3.2 * 2.5 = ${result}`);</div>
<div class="line"> </div>
<div class="line">const vehicle = new sample.Vehicle(&quot;Truck&quot;);</div>
<div class="line">vehicle.setVelocity({ x: 1.0, y: 2.0, z: 3.0 });</div>
<div class="line">const dot = vehicle.dotVelocity({ x: 3.0, y: 2.0, z: 1.0 });</div>
<div class="line"> </div>
<div class="line">console.log(`Vehicle &#39;${vehicle.name}&#39; dot: ${dot}`);</div>
<div class="line"> </div>
<div class="line">vehicle.delete();</div>
</div><!-- fragment --><p>In the <code>package.json</code> file, you can add the following script:</p>
<div class="fragment"><div class="line">@json</div>
<div class="line">&quot;tests&quot;: &quot;node tests/node-test-esm.js&quot;</div>
</div><!-- fragment --><p>To run the test, execute:</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line">npm run tests</div>
</div><!-- fragment --><p>The expected output should be:</p>
<div class="fragment"><div class="line">3.2 * 2.5 = 8</div>
<div class="line">Vehicle &#39;Truck&#39; dot: 10</div>
</div><!-- fragment --><h2><a class="anchor" id="conclusion"></a>
Conclusion</h2>
<p>In this guide, we've covered:</p><ul>
<li>Creating a C library with automatic API updates from IDL specification files using IDLC</li>
<li>Packaging an npm module for native JavaScript usage - all powered by the same IDLC tool</li>
</ul>
<p>The complete example library can be cloned as follows. You'll also find a README with detailed build instructions there.</p>
<div class="fragment"><div class="line">@bash</div>
<div class="line">git clone -b sample https://github.com/VladimirShaleev/idlc.git idlc-sample</div>
</div><!-- fragment --><h2><a class="anchor" id="next-steps"></a>
Next Steps</h2>
<p>Continue learning about IDL by following the link below.</p>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a href="index.html">Introduction</a>   </td><td class="markdownTableBodyRight"><a href="language-guide.html">Language Guide</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script type="text/javascript">
    DoxygenHighlight.apply()
</script>
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:left;"><a href="https://github.com/VladimirShaleev/idlc">GitHub Repository</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
